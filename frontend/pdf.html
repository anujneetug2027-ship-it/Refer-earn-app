<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AmbikaShelf Image to PDF</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0f172a;
  color:white;
  text-align:center;
}

header{
  padding:15px;
}

header img{
  height:50px;
}

.container{
  padding:20px;
}

#previewCanvas{
  background:white;
  margin:20px auto;
  border-radius:8px;
  max-width:600px;
}

.thumbnail-strip{
  display:flex;
  overflow-x:auto;
  gap:10px;
  padding:10px;
  justify-content:center;
}

.thumb{
  position:relative;
}

.thumb img{
  width:100px;
  height:100px;
  object-fit:cover;
  border-radius:8px;
  border:2px solid #38bdf8;
}

.thumb span{
  position:absolute;
  top:4px;
  left:6px;
  background:black;
  font-size:12px;
  padding:2px 6px;
  border-radius:4px;
}

.thumb button{
  position:absolute;
  top:4px;
  right:4px;
  background:red;
  border:none;
  color:white;
  cursor:pointer;
  border-radius:50%;
  width:20px;
  height:20px;
}

.thumb .edit{
  bottom:4px;
  top:auto;
  background:#38bdf8;
}

.add-btn{
  display:flex;
  align-items:center;
  justify-content:center;
  width:100px;
  height:100px;
  border:2px dashed #38bdf8;
  border-radius:8px;
  cursor:pointer;
  font-size:30px;
}

button.main{
  padding:10px 20px;
  margin:10px;
  border:none;
  border-radius:6px;
  background:#38bdf8;
  cursor:pointer;
  font-weight:bold;
}

input[type="file"]{
  display:none;
}

input[type="password"]{
  padding:8px;
  margin-top:10px;
  border-radius:6px;
  border:none;
}
</style>
</head>

<body>

<header>
  <img src="https://ambikashelf.shop/ambikashelf.png">
</header>

<div class="container">

<h2>Image to PDF Converter</h2>

<canvas id="previewCanvas"></canvas>

<div class="thumbnail-strip" id="thumbContainer"></div>

<input type="file" id="fileInput" accept="image/*" multiple>

<br>

<label>
Optional PDF Password:
<br>
<input type="password" id="pdfPassword" placeholder="Leave empty if not needed">
</label>

<br>

<button class="main" onclick="generatePreview()">Preview PDF</button>
<button class="main" onclick="downloadPDF()">Download PDF</button>

</div>

<script>

const fileInput = document.getElementById("fileInput");
const thumbContainer = document.getElementById("thumbContainer");
const canvas = document.getElementById("previewCanvas");
const ctx = canvas.getContext("2d");

let images = [];

fileInput.addEventListener("change", e=>{
  addFiles(e.target.files);
});

function addFiles(files){
  for(let file of files){
    if(images.length >= 10){
      alert("Maximum 10 images allowed");
      return;
    }
    if(file.type.startsWith("image/")){
      const reader = new FileReader();
      reader.onload = e=>{
        images.push(e.target.result);
        renderThumbnails();
      };
      reader.readAsDataURL(file);
    }
  }
}

function renderThumbnails(){
  thumbContainer.innerHTML="";

  images.forEach((src,index)=>{
    const div=document.createElement("div");
    div.className="thumb";

    div.innerHTML=`
      <img src="${src}">
      <span>${index+1}</span>
      <button onclick="removeImage(${index})">×</button>
      <button class="edit" onclick="editImage(${index})">✏</button>
    `;
    thumbContainer.appendChild(div);
  });

  const add=document.createElement("div");
  add.className="add-btn";
  add.innerHTML="+";
  add.onclick=()=>fileInput.click();
  thumbContainer.appendChild(add);
}

function removeImage(index){
  images.splice(index,1);
  renderThumbnails();
}

function editImage(index){
  const newImg = prompt("Basic Crop: Enter crop ratio (e.g. 1 for square, 0 to cancel)");
  if(newImg && Number(newImg)>0){
    const img=new Image();
    img.src=images[index];
    img.onload=function(){
      const size=Math.min(img.width,img.height);
      const temp=document.createElement("canvas");
      temp.width=size;
      temp.height=size;
      const tctx=temp.getContext("2d");
      tctx.drawImage(img,(img.width-size)/2,(img.height-size)/2,size,size,0,0,size,size);
      images[index]=temp.toDataURL("image/jpeg");
      renderThumbnails();
    }
  }
}

new Sortable(thumbContainer,{
  animation:150,
  onEnd:function(evt){
    const moved=images.splice(evt.oldIndex,1)[0];
    images.splice(evt.newIndex,0,moved);
    renderThumbnails();
  }
});

function generatePreview(){
  if(images.length===0) return alert("Add images first");

  const img=new Image();
  img.src=images[0];
  img.onload=function(){
    canvas.width=400;
    canvas.height=560;
    ctx.fillStyle="white";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(img,0,0,canvas.width,canvas.height);
  }
}

async function downloadPDF(){
  if(images.length===0) return alert("Add images first");

  const { jsPDF } = window.jspdf;
  const pdf=new jsPDF("p","mm","a4");

  for(let i=0;i<images.length;i++){
    const img=new Image();
    img.src=images[i];

    await new Promise(resolve=>{
      img.onload=function(){
        const pageWidth=pdf.internal.pageSize.getWidth();
        const pageHeight=pdf.internal.pageSize.getHeight();
        pdf.addImage(img,"JPEG",0,0,pageWidth,pageHeight);
        if(i<images.length-1) pdf.addPage();
        resolve();
      }
    });
  }

  const password=document.getElementById("pdfPassword").value;

  if(password){
    pdf.setEncryption({
      userPassword: password,
      ownerPassword: password,
      userPermissions: ["print"]
    });
  }

  pdf.save("AmbikaShelf.pdf");
}

</script>

</body>
  </html>
