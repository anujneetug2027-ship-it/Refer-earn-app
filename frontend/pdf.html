<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AmbikaShelf Professional Image to PDF Editor</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

<style>

/* ===========================
   GLOBAL STYLES
=========================== */

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
}

body{
  font-family:Segoe UI, sans-serif;
  background:linear-gradient(135deg,#0f172a,#111827);
  color:white;
  min-height:100vh;
}

header{
  background:#111827;
  padding:20px;
  text-align:center;
  box-shadow:0 5px 20px rgba(0,0,0,0.4);
}

header img{
  height:65px;
}

.container{
  max-width:1200px;
  margin:auto;
  padding:25px;
}

h2{
  text-align:center;
  font-weight:500;
  margin-bottom:25px;
}

/* ===========================
   LIVE PREVIEW AREA
=========================== */

.preview-wrapper{
  display:none;
  height:620px;
  overflow-y:auto;
  border-radius:15px;
  background:#1e293b;
  padding:20px;
  margin-bottom:25px;
  box-shadow:0 10px 30px rgba(0,0,0,0.5);
}

.preview-page{
  background:white;
  width:100%;
  max-width:450px;
  height:630px;
  margin:0 auto 20px auto;
  border-radius:10px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}

.preview-page img{
  width:100%;
  height:100%;
  object-fit:contain;
}

/* ===========================
   THUMBNAILS
=========================== */

.thumbnail-container{
  display:flex;
  gap:12px;
  overflow-x:auto;
  padding-bottom:10px;
}

.thumb{
  position:relative;
  cursor:grab;
}

.thumb img{
  width:115px;
  height:115px;
  object-fit:cover;
  border-radius:10px;
  border:2px solid #38bdf8;
}

.thumb-number{
  position:absolute;
  top:5px;
  left:6px;
  background:black;
  padding:3px 7px;
  font-size:12px;
  border-radius:6px;
}

.thumb button{
  position:absolute;
  width:23px;
  height:23px;
  border:none;
  border-radius:50%;
  font-size:13px;
  cursor:pointer;
}

.remove-btn{
  top:5px;
  right:5px;
  background:red;
  color:white;
}

.edit-btn{
  bottom:5px;
  right:5px;
  background:#38bdf8;
  color:black;
}

.add-thumb{
  width:115px;
  height:115px;
  border-radius:10px;
  border:2px dashed #38bdf8;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:32px;
  cursor:pointer;
}

/* ===========================
   CONTROLS
=========================== */

.controls{
  text-align:center;
  margin-top:25px;
}

.controls input{
  padding:10px;
  border-radius:8px;
  border:none;
  margin:8px;
  min-width:220px;
}

.controls button{
  padding:10px 20px;
  border:none;
  border-radius:8px;
  background:#38bdf8;
  font-weight:600;
  cursor:pointer;
  margin:10px;
}

/* ===========================
   EDIT MODAL
=========================== */

.modal{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.85);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}

.modal-content{
  background:#111827;
  padding:20px;
  border-radius:12px;
  text-align:center;
}

#editCanvas{
  background:white;
  border-radius:8px;
  cursor:crosshair;
}

.modal-buttons button{
  padding:8px 15px;
  margin:8px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

</style>
</head>
<body>

<header>
  <img src="https://ambikashelf.shop/ambikashelf.png">
</header>

<div class="container">

<h2>Professional Image to PDF Editor</h2>

<div id="previewWrapper" class="preview-wrapper"></div>

<div id="thumbnailContainer" class="thumbnail-container"></div>

<div class="controls">

<input type="file" id="fileInput" accept="image/*" multiple>
<br>
<input type="text" id="pdfName" placeholder="Enter PDF File Name">
<br>
<input type="password" id="pdfPassword" placeholder="Optional PDF Password">
<br>
<button onclick="downloadPDF()">Download PDF</button>

</div>

</div>

<!-- EDIT MODAL -->
<div class="modal" id="editModal">
  <div class="modal-content">
    <canvas id="editCanvas"></canvas>
    <div class="modal-buttons">
      <button onclick="enableCrop()">Crop Mode</button>
      <button onclick="enableDraw()">Draw Mode</button>
      <button onclick="saveEdit()">Save</button>
      <button onclick="closeModal()">Cancel</button>
    </div>
  </div>
</div>

<script>

/* =============================
   GLOBAL STATE
============================= */

const fileInput = document.getElementById("fileInput");
const thumbnailContainer = document.getElementById("thumbnailContainer");
const previewWrapper = document.getElementById("previewWrapper");
const pdfNameInput = document.getElementById("pdfName");
const pdfPasswordInput = document.getElementById("pdfPassword");

const editModal = document.getElementById("editModal");
const editCanvas = document.getElementById("editCanvas");
const editCtx = editCanvas.getContext("2d");

let images = [];
let currentEditIndex = null;


/* =============================
   FILE UPLOAD
============================= */

fileInput.addEventListener("change", e=>{
  const files = e.target.files;

  for(let file of files){
    if(images.length >= 10){
      alert("Maximum 10 images allowed.");
      return;
    }

    const reader = new FileReader();
    reader.onload = ev=>{
      images.push(ev.target.result);
      renderThumbnails();
      renderPreview();
    };
    reader.readAsDataURL(file);
  }
});

/* =============================
   THUMBNAILS
============================= */

function renderThumbnails(){
  thumbnailContainer.innerHTML = "";

  images.forEach((src,index)=>{

    const div = document.createElement("div");
    div.className = "thumb";
    div.dataset.index = index;

    const img = document.createElement("img");
    img.src = src;

    const number = document.createElement("div");
    number.className = "thumb-number";
    number.textContent = index + 1;

    const removeBtn = document.createElement("button");
    removeBtn.className = "remove-btn";
    removeBtn.textContent = "×";

    removeBtn.addEventListener("click", function(e){
      e.stopPropagation();
      removeImage(index);
    });

    const editBtn = document.createElement("button");
    editBtn.className = "edit-btn";
    editBtn.textContent = "✏";

    editBtn.addEventListener("click", function(e){
      e.stopPropagation();
      openEditor(index);
    });

    div.appendChild(img);
    div.appendChild(number);
    div.appendChild(removeBtn);
    div.appendChild(editBtn);

    thumbnailContainer.appendChild(div);
  });

  const add = document.createElement("div");
  add.className="add-thumb";
  add.textContent="+";
  add.addEventListener("click", ()=>fileInput.click());

  thumbnailContainer.appendChild(add);
   }
function removeImage(index){
  images.splice(index,1);
  renderThumbnails();
  renderPreview();
}

/* =============================
   DRAG SORT
============================= */
new Sortable(thumbnailContainer,{
  animation:150,
  draggable: ".thumb",
  filter: "button",
  preventOnFilter: false,
  onEnd:function(evt){
    if(evt.oldIndex == null || evt.newIndex == null) return;

    const moved = images.splice(evt.oldIndex,1)[0];
    images.splice(evt.newIndex,0,moved);
    renderThumbnails();
    renderPreview();
  }
});

/* =============================
   LIVE PREVIEW
============================= */

function renderPreview(){
  previewWrapper.innerHTML="";

  if(images.length === 0){
    previewWrapper.style.display="none";
    return;
  }

  previewWrapper.style.display="block";

  images.forEach(src=>{
    const page = document.createElement("div");
    page.className="preview-page";

    const img = document.createElement("img");
    img.src = src;

    page.appendChild(img);
    previewWrapper.appendChild(page);
  });
}

/* =============================
   DOWNLOAD PDF
============================= */

async function downloadPDF(){
  if(images.length === 0) return alert("Add images first");

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("p","mm","a4");

  for(let i=0;i<images.length;i++){
    const img = new Image();
    img.src = images[i];

    await new Promise(resolve=>{
      img.onload = function(){
        const w = pdf.internal.pageSize.getWidth();
        const h = pdf.internal.pageSize.getHeight();
        pdf.addImage(img,"JPEG",0,0,w,h);
        if(i < images.length-1) pdf.addPage();
        resolve();
      }
    });
  }

  const password = pdfPasswordInput.value.trim();
  if(password){
    try{
      pdf.setEncryption({
        userPassword: password,
        ownerPassword: password,
        userPermissions: ["print"]
      });
    }catch(e){
      console.warn("Encryption may not be supported in this browser.");
    }
  }

  let fileName = pdfNameInput.value.trim();
  if(!fileName) fileName = "AmbikaShelf";
  pdf.save(fileName + ".pdf");
}

/* =============================
   EDITOR
============================= */
/* =============================
   CLEAN WORKING EDITOR SYSTEM
============================= */

let baseImage = new Image();
let isDrawing = false;
let cropMode = false;
let drawMode = false;
let startX = 0;
let startY = 0;
let cropRect = null;

function openEditor(index){
  currentEditIndex = index;
  editModal.style.display = "flex";

  cropMode = false;
  drawMode = false;
  cropRect = null;

  baseImage = new Image();
  baseImage.src = images[index];

  baseImage.onload = function(){
    editCanvas.width = baseImage.width;
    editCanvas.height = baseImage.height;

    editCtx.clearRect(0,0,editCanvas.width,editCanvas.height);
    editCtx.drawImage(baseImage,0,0);
  }
}

function enableCrop(){
  cropMode = true;
  drawMode = false;
}

function enableDraw(){
  drawMode = true;
  cropMode = false;
}

editCanvas.onmousedown = function(e){
  isDrawing = true;
  startX = e.offsetX;
  startY = e.offsetY;

  if(drawMode){
    editCtx.beginPath();
    editCtx.moveTo(startX,startY);
  }
};

editCanvas.onmousemove = function(e){
  if(!isDrawing) return;

  const currentX = e.offsetX;
  const currentY = e.offsetY;

  if(cropMode){
    const width = currentX - startX;
    const height = currentY - startY;

    cropRect = {x:startX,y:startY,width,height};

    editCtx.clearRect(0,0,editCanvas.width,editCanvas.height);
    editCtx.drawImage(baseImage,0,0);

    editCtx.strokeStyle = "red";
    editCtx.lineWidth = 3;
    editCtx.strokeRect(startX,startY,width,height);
  }

  if(drawMode){
    editCtx.lineWidth = 3;
    editCtx.strokeStyle = "yellow";
    editCtx.lineTo(currentX,currentY);
    editCtx.stroke();
  }
};

editCanvas.onmouseup = function(){
  isDrawing = false;
};

function saveEdit(){

  if(cropMode && cropRect){

    const tempCanvas = document.createElement("canvas");
    tempCanvas.width = Math.abs(cropRect.width);
    tempCanvas.height = Math.abs(cropRect.height);

    const tctx = tempCanvas.getContext("2d");

    tctx.drawImage(
      editCanvas,
      cropRect.x,
      cropRect.y,
      cropRect.width,
      cropRect.height,
      0,
      0,
      cropRect.width,
      cropRect.height
    );

    images[currentEditIndex] = tempCanvas.toDataURL("image/jpeg");

  } else {
    images[currentEditIndex] = editCanvas.toDataURL("image/jpeg");
  }

  closeModal();
  renderThumbnails();
  renderPreview();
}

function closeModal(){
  editModal.style.display = "none";
  cropRect = null;
  cropMode = false;
  drawMode = false;
  }
</script>

</body>
</html>
