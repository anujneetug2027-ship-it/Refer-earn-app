<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AmbikaShelf Pro Image to PDF</title>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

<style>

/* ===============================
   GLOBAL STYLES
================================= */

*{
  box-sizing:border-box;
  margin:0;
  padding:0;
}

body{
  font-family:Segoe UI, sans-serif;
  background:#0f172a;
  color:white;
  min-height:100vh;
}

header{
  text-align:center;
  padding:20px;
  background:#111827;
  box-shadow:0 2px 10px rgba(0,0,0,0.4);
}

header img{
  height:60px;
}

.container{
  max-width:1100px;
  margin:auto;
  padding:20px;
}

h2{
  text-align:center;
  margin-bottom:20px;
  font-weight:500;
}

/* ===============================
   PDF PREVIEW
================================= */

.preview-wrapper{
  display:flex;
  justify-content:center;
  margin-bottom:25px;
}

#pdfPreview{
  background:white;
  width:420px;
  height:600px;
  border-radius:12px;
  box-shadow:0 8px 25px rgba(0,0,0,0.5);
}

/* ===============================
   THUMBNAIL STRIP
================================= */

.thumbnail-container{
  display:flex;
  gap:12px;
  overflow-x:auto;
  padding:10px 0;
  margin-bottom:20px;
}

.thumb{
  position:relative;
  cursor:grab;
}

.thumb img{
  width:110px;
  height:110px;
  object-fit:cover;
  border-radius:10px;
  border:2px solid #38bdf8;
}

.thumb-number{
  position:absolute;
  top:5px;
  left:6px;
  background:black;
  padding:2px 6px;
  font-size:12px;
  border-radius:6px;
}

.thumb button{
  position:absolute;
  width:22px;
  height:22px;
  border:none;
  border-radius:50%;
  font-size:12px;
  cursor:pointer;
}

.remove-btn{
  top:5px;
  right:5px;
  background:red;
  color:white;
}

.edit-btn{
  bottom:5px;
  right:5px;
  background:#38bdf8;
  color:black;
}

.add-thumb{
  display:flex;
  align-items:center;
  justify-content:center;
  width:110px;
  height:110px;
  border:2px dashed #38bdf8;
  border-radius:10px;
  font-size:30px;
  cursor:pointer;
}

/* ===============================
   CONTROLS
================================= */

.controls{
  text-align:center;
  margin-top:15px;
}

.controls button{
  padding:10px 18px;
  margin:6px;
  border:none;
  border-radius:8px;
  font-weight:600;
  cursor:pointer;
  background:#38bdf8;
}

.controls input{
  padding:8px;
  border-radius:6px;
  border:none;
  margin-top:8px;
}

/* ===============================
   EDIT MODAL
================================= */

.modal{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.8);
  display:none;
  align-items:center;
  justify-content:center;
}

.modal-content{
  background:#111827;
  padding:20px;
  border-radius:12px;
}

#editCanvas{
  background:white;
  cursor:crosshair;
  border-radius:8px;
}

.modal-buttons{
  text-align:center;
  margin-top:10px;
}

.modal-buttons button{
  padding:8px 15px;
  margin:5px;
}

</style>
</head>
<body>

<header>
  <img src="https://ambikashelf.shop/ambikashelf.png">
</header>

<div class="container">

<h2>Professional Image to PDF Editor</h2>

<div class="preview-wrapper">
  <canvas id="pdfPreview"></canvas>
</div>

<div class="thumbnail-container" id="thumbnailContainer"></div>

<div class="controls">
  <input type="file" id="fileInput" accept="image/*" multiple>
  <br><br>
  <label>Optional PDF Password:</label><br>
  <input type="password" id="pdfPassword" placeholder="Leave empty if not needed">
  <br>
  <button onclick="generatePreview()">Preview</button>
  <button onclick="downloadPDF()">Download PDF</button>
</div>

</div>

<!-- EDIT MODAL -->
<div class="modal" id="editModal">
  <div class="modal-content">
    <canvas id="editCanvas"></canvas>
    <div class="modal-buttons">
      <button onclick="applyCrop()">Apply Crop</button>
      <button onclick="enableDraw()">Draw</button>
      <button onclick="saveEdit()">Save</button>
      <button onclick="closeModal()">Cancel</button>
    </div>
  </div>
</div>

<script>

/* ===================================
   GLOBAL STATE
=================================== */

const fileInput = document.getElementById("fileInput");
const thumbnailContainer = document.getElementById("thumbnailContainer");
const previewCanvas = document.getElementById("pdfPreview");
const previewCtx = previewCanvas.getContext("2d");

const editModal = document.getElementById("editModal");
const editCanvas = document.getElementById("editCanvas");
const editCtx = editCanvas.getContext("2d");

let images = [];
let currentEditIndex = null;
let isDrawing = false;
let startX, startY;
let cropRect = null;

/* ===================================
   FILE HANDLING
=================================== */

fileInput.addEventListener("change", e=>{
  const files = e.target.files;
  for(let file of files){
    if(images.length >= 10){
      alert("Maximum 10 images allowed.");
      return;
    }
    const reader = new FileReader();
    reader.onload = ev=>{
      images.push(ev.target.result);
      renderThumbnails();
    }
    reader.readAsDataURL(file);
  }
});

/* ===================================
   THUMBNAILS
=================================== */

function renderThumbnails(){
  thumbnailContainer.innerHTML = "";

  images.forEach((src,index)=>{
    const div = document.createElement("div");
    div.className="thumb";
    div.innerHTML = `
      <img src="${src}">
      <div class="thumb-number">${index+1}</div>
      <button class="remove-btn" onclick="removeImage(${index})">×</button>
      <button class="edit-btn" onclick="openEditor(${index})">✏</button>
    `;
    thumbnailContainer.appendChild(div);
  });

  const add = document.createElement("div");
  add.className="add-thumb";
  add.innerHTML="+";
  add.onclick = ()=>fileInput.click();
  thumbnailContainer.appendChild(add);
}

function removeImage(index){
  images.splice(index,1);
  renderThumbnails();
}

/* ===================================
   DRAG REORDER
=================================== */

new Sortable(thumbnailContainer,{
  animation:150,
  onEnd: function(evt){
    const moved = images.splice(evt.oldIndex,1)[0];
    images.splice(evt.newIndex,0,moved);
    renderThumbnails();
  }
});

/* ===================================
   PDF PREVIEW
=================================== */

function generatePreview(){
  if(images.length === 0) return alert("Add images first");

  const img = new Image();
  img.src = images[0];
  img.onload = function(){
    previewCanvas.width = 420;
    previewCanvas.height = 600;
    previewCtx.fillStyle="white";
    previewCtx.fillRect(0,0,420,600);
    previewCtx.drawImage(img,0,0,420,600);
  }
}

/* ===================================
   PDF DOWNLOAD
=================================== */

async function downloadPDF(){
  if(images.length === 0) return alert("Add images first");

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("p","mm","a4");

  for(let i=0;i<images.length;i++){
    const img = new Image();
    img.src = images[i];

    await new Promise(resolve=>{
      img.onload = function(){
        const w = pdf.internal.pageSize.getWidth();
        const h = pdf.internal.pageSize.getHeight();
        pdf.addImage(img,"JPEG",0,0,w,h);
        if(i < images.length-1) pdf.addPage();
        resolve();
      }
    });
  }

  const password = document.getElementById("pdfPassword").value;
  if(password){
    pdf.setEncryption({
      userPassword: password,
      ownerPassword: password,
      userPermissions: ["print"]
    });
  }

  pdf.save("AmbikaShelf.pdf");
}

/* ===================================
   IMAGE EDITOR
=================================== */

function openEditor(index){
  currentEditIndex = index;
  editModal.style.display="flex";

  const img = new Image();
  img.src = images[index];
  img.onload = function(){
    editCanvas.width = img.width;
    editCanvas.height = img.height;
    editCtx.drawImage(img,0,0);
  }
}

editCanvas.addEventListener("mousedown", e=>{
  startX = e.offsetX;
  startY = e.offsetY;
  isDrawing = true;
});

editCanvas.addEventListener("mousemove", e=>{
  if(!isDrawing) return;
  const width = e.offsetX - startX;
  const height = e.offsetY - startY;

  cropRect = {x:startX,y:startY,width,height};

  editCtx.clearRect(0,0,editCanvas.width,editCanvas.height);
  const img = new Image();
  img.src = images[currentEditIndex];
  img.onload = ()=>{
    editCtx.drawImage(img,0,0);
    editCtx.strokeStyle="red";
    editCtx.strokeRect(startX,startY,width,height);
  }
});

editCanvas.addEventListener("mouseup", ()=>isDrawing=false);

function applyCrop(){
  if(!cropRect) return alert("Draw crop area first");

  const temp = document.createElement("canvas");
  temp.width = cropRect.width;
  temp.height = cropRect.height;
  const tctx = temp.getContext("2d");

  tctx.drawImage(editCanvas,
    cropRect.x,cropRect.y,
    cropRect.width,cropRect.height,
    0,0,
    cropRect.width,cropRect.height
  );

  editCtx.clearRect(0,0,editCanvas.width,editCanvas.height);
  editCanvas.width = cropRect.width;
  editCanvas.height = cropRect.height;
  editCtx.drawImage(temp,0,0);
}

function enableDraw(){
  editCanvas.onmousemove = function(e){
    if(isDrawing){
      editCtx.lineWidth=2;
      editCtx.strokeStyle="yellow";
      editCtx.lineTo(e.offsetX,e.offsetY);
      editCtx.stroke();
    }
  };
}

function saveEdit(){
  images[currentEditIndex] = editCanvas.toDataURL("image/jpeg");
  closeModal();
  renderThumbnails();
}

function closeModal(){
  editModal.style.display="none";
  cropRect = null;
}

</script>

</body>
  </html>
