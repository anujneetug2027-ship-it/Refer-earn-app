<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>World Chat â€” Ambika Shelf</title>

<style>
:root{
  --bg:#0f1724;
  --card:#0b1220;
  --muted:#94a3b8;
  --accent:#06b6d4;
  --glass: rgba(255,255,255,0.06);
  --radius:16px;
  font-family: Inter, system-ui;
}

*{box-sizing:border-box;}

body{
  margin:0;
  background:linear-gradient(180deg,#071124 0%, #071a2b 100%);
  color:#e6eef8;
  display:flex;
  flex-direction:column;
  height:100vh;
}

/* TOPBAR */
.topbar{
  display:flex;
  justify-content:flex-end;
  padding:10px 20px;
}
.menu-btn{font-size:26px;cursor:pointer;}

/* MAIN WRAPPER */
.chat-container{
  flex:1;
  display:flex;
  flex-direction:column;
  max-width:900px;
  margin:auto;
  width:100%;
  padding:10px;
}

/* LOGO */
.logo-top{
  text-align:center;
  margin-bottom:10px;
}
.logo-top img{width:150px;}

/* MESSAGES */
#messages{
  flex:1;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:10px;
  padding-bottom:80px;
}

/* MESSAGE */
.message{
  max-width:75%;
  padding:10px 14px;
  border-radius:16px;
  position:relative;
  animation:fadeIn .3s ease;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(5px);}
  to{opacity:1;transform:translateY(0);}
}

.message.self{
  align-self:flex-end;
  background:linear-gradient(90deg,var(--accent),#60a5fa);
  color:#022;
}
.message.other{
  align-self:flex-start;
  background:var(--glass);
}

.msg-time{
  font-size:11px;
  margin-top:5px;
}
.message.self .msg-time{
  color:black;
}
.message.other .msg-time{
  color:var(--muted);
}

.copy-btn{
  margin-left:8px;
  cursor:pointer;
  font-size:11px;
  transition:.2s;
}
.copy-btn:hover{
  transform:scale(1.2);
  color:var(--accent);
}

/* REACTIONS */
.reactions{
  margin-top:4px;
  font-size:14px;
}

/* REPLY BOX */
.reply-box{
  font-size:12px;
  background:rgba(255,255,255,0.1);
  padding:5px;
  border-left:3px solid var(--accent);
  margin-bottom:6px;
  border-radius:6px;
}

/* INPUT BAR */
.input-wrapper{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#0b1220;
  padding:10px;
  display:flex;
  gap:8px;
  align-items:center;
}

#msg{
  flex:1;
  padding:10px;
  border-radius:10px;
  border:none;
  background:var(--glass);
  color:white;
}

button{
  background:linear-gradient(90deg,var(--accent),#60a5fa);
  border:none;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}

.exit-btn{
  background:#ef4444;
  color:white;
}

.typing{
  font-size:12px;
  color:var(--muted);
  margin-bottom:5px;
}

/* IMAGE */
.chat-image{
  max-width:200px;
  border-radius:8px;
  margin-top:6px;
}
.download-btn{
  font-size:11px;
  cursor:pointer;
  margin-top:3px;
  display:inline-block;
  color:var(--accent);
}
</style>
</head>
<body>

<div class="chat-container">

<div class="logo-top">
  <img src="https://ambikashelf.shop/ambikashelf.png">
</div>

<div id="messages"></div>

<div id="typing" class="typing"></div>

</div>

<div class="input-wrapper">
  <input type="file" id="imageInput" style="display:none">
  <button onclick="document.getElementById('imageInput').click()">ðŸ“·</button>
  <input id="msg" placeholder="Type message">
  <button onclick="sendMessage()">Send</button>
  <button class="exit-btn" onclick="exitChat()">Exit</button>
</div>

<audio id="sendSound" src="https://ambikashelf.shop/send.mp3"></audio>
<audio id="receiveSound" src="https://ambikashelf.shop/recieve.mp3"></audio>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let username = prompt("Enter username");
let currentReply=null;

socket.emit("join", username);

const messagesDiv=document.getElementById("messages");

socket.on("oldMessages",msgs=>{
  msgs.forEach(addMessage);
});

socket.on("message",data=>{
  addMessage(data);
  if(data.user===username)
    document.getElementById("sendSound").play();
  else
    document.getElementById("receiveSound").play();
});

socket.on("typing",user=>{
  document.getElementById("typing").innerText=user+" is typing...";
});
socket.on("stopTyping",()=>{
  document.getElementById("typing").innerText="";
});

socket.on("reactionUpdate",({id,reactions})=>{
  const msgDiv=document.getElementById("msg-"+id);
  if(!msgDiv)return;
  const reactionDiv=msgDiv.querySelector(".reactions");
  reactionDiv.innerHTML="";
  for(let r in reactions){
    reactionDiv.innerHTML+=`${r} ${reactions[r]} `;
  }
});

function sendMessage(){
  const text=document.getElementById("msg").value.trim();
  const imageFile=document.getElementById("imageInput").files[0];

  if(!text && !imageFile) return;

  if(imageFile){
    const reader=new FileReader();
    reader.onload=function(e){
      socket.emit("sendMessage",{text,image:e.target.result,reply:currentReply});
    };
    reader.readAsDataURL(imageFile);
    document.getElementById("imageInput").value="";
  }else{
    socket.emit("sendMessage",{text,reply:currentReply});
  }

  document.getElementById("msg").value="";
  currentReply=null;
}

function addMessage(data){
  const div=document.createElement("div");
  div.className="message "+(data.user===username?"self":"other");
  div.id="msg-"+data.id;

  let replyHTML="";
  if(data.reply){
    replyHTML=`<div class="reply-box">${data.reply}</div>`;
  }

  let imageHTML="";
  if(data.image){
    imageHTML=`
      <img src="${data.image}" class="chat-image">
      <div class="download-btn" onclick="downloadImage('${data.image}')">Download</div>
    `;
  }

  div.innerHTML=`
    ${replyHTML}
    <b>${data.user}:</b> ${data.text||""}
    ${imageHTML}
    <div class="msg-time">
      ${data.time}
      <span class="copy-btn" onclick="copyText('${data.text||""}')">ðŸ“‹</span>
    </div>
    <div class="reactions"></div>
  `;

  // Double tap reaction
  div.ondblclick=()=>{
    const emoji=prompt("React with: ðŸ‘ ðŸ˜‚ ðŸ˜… ðŸ™ ðŸ˜¥");
    if(["ðŸ‘","ðŸ˜‚","ðŸ˜…","ðŸ™","ðŸ˜¥"].includes(emoji)){
      socket.emit("react",{id:data.id,emoji});
    }
  };

  // Swipe reply
  let startX;
  div.addEventListener("touchstart",e=>startX=e.touches[0].clientX);
  div.addEventListener("touchend",e=>{
    if(e.changedTouches[0].clientX-startX>80){
      currentReply=data.text;
      alert("Replying to: "+data.text);
    }
  });

  messagesDiv.appendChild(div);
  messagesDiv.scrollTop=messagesDiv.scrollHeight;
}

function copyText(text){
  navigator.clipboard.writeText(text);
}

function downloadImage(src){
  const a=document.createElement("a");
  a.href=src;
  a.download="image.png";
  a.click();
}

function exitChat(){
  location.reload();
}

document.getElementById("msg").addEventListener("input",()=>{
  socket.emit("typing");
  setTimeout(()=>socket.emit("stopTyping"),1500);
});
</script>

</body>
</html>
