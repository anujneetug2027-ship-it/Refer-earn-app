<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Scanner & Generator</title>

<!-- Scanner Library -->
<script src="https://unpkg.com/html5-qrcode"></script>

<!-- QR Generator -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg,#667eea,#764ba2);
    margin: 0;
    padding: 0;
    text-align: center;
    color: white;
}

.container {
    max-width: 600px;
    margin: auto;
    padding: 20px;
}

section {
    background: white;
    color: black;
    padding: 20px;
    margin-top: 20px;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

button {
    padding: 10px 15px;
    margin: 8px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    background: #667eea;
    color: white;
    font-weight: bold;
}

button:hover {
    background: #5a67d8;
}

input {
    padding: 10px;
    width: 85%;
    margin-top: 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
}

#reader {
    width: 100%;
    margin-top: 10px;
}

.result-box {
    margin-top: 15px;
    padding: 10px;
    background: #f3f3f3;
    border-radius: 6px;
}
</style>
</head>

<body>

<div class="container">
    <h1>QR Scanner & Generator</h1>

    <!-- SCANNER -->
    <section>
        <h2>Scan QR Code</h2>

        <div id="reader"></div>

        <button onclick="startScanner()">Start Camera</button>
        <button onclick="stopScanner()">Stop Camera</button>

        <h3>Or Upload Image</h3>
        <input type="file" id="qr-upload" accept="image/*">

        <div id="scan-result" class="result-box"></div>
    </section>

    <!-- GENERATOR -->
    <section>
        <h2>Generate QR Code</h2>

        <input type="text" id="qr-input" placeholder="Enter URL here">
        <br>
        <button onclick="generateQR()">Generate QR</button>

        <div id="qr-output" style="margin-top:15px;"></div>
    </section>

</div>

<script>

let html5QrCode;

// Start Camera Scanner
function startScanner() {
    html5QrCode = new Html5Qrcode("reader");

    html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        qrMessage => {
            showResult(qrMessage);
            stopScanner();
        }
    ).catch(err => {
        alert("Camera permission required.");
    });
}

// Stop Scanner
function stopScanner() {
    if (html5QrCode) {
        html5QrCode.stop().then(() => {
            html5QrCode.clear();
        }).catch(err => console.log(err));
    }
}

// Show Scan Result
function showResult(text) {
    const resultBox = document.getElementById("scan-result");

    let isUrl = text.startsWith("http");

    resultBox.innerHTML = `
        <strong>Decoded:</strong><br>${text}<br><br>
        ${isUrl ? `<a href="${text}" target="_blank"><button>Go To Site</button></a>` : ""}
        <button onclick="copyText('${text}')">Copy</button>
    `;
}

// Copy to Clipboard
function copyText(text) {
    navigator.clipboard.writeText(text);
    alert("Copied!");
}

// Upload QR Image Scanner
document.getElementById("qr-upload").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function() {
        const html5QrCode = new Html5Qrcode("reader");
        html5QrCode.scanFile(file, true)
            .then(decodedText => {
                showResult(decodedText);
            })
            .catch(err => {
                alert("No QR code found.");
            });
    };
    reader.readAsDataURL(file);
});

// Generate QR
function generateQR() {
    const input = document.getElementById("qr-input").value;
    const output = document.getElementById("qr-output");

    output.innerHTML = "";

    if (!input) {
        alert("Enter valid text or URL");
        return;
    }

    new QRCode(output, {
        text: input,
        width: 200,
        height: 200
    });
}

</script>

</body>
  </html>
