<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Tools â€” Ambika Shelf</title>

<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
:root{
  --bg:#0f1724;
  --card:#0b1220;
  --muted:#94a3b8;
  --accent:#06b6d4;
  --glass: rgba(255,255,255,0.03);
  --radius:12px;
  font-family: Inter, system-ui;
}

body{
  margin:0;
  background:linear-gradient(180deg,#071124 0%, #071a2b 100%);
  color:#e6eef8;
}

.wrapper{
  max-width:920px;
  margin:40px auto;
  padding:28px;
}

.card{
  background:var(--card);
  padding:18px;
  border-radius:var(--radius);
  border:1px solid rgba(255,255,255,0.03);
  margin-bottom:20px;
}

h2{
  margin-top:0;
}

button{
  background:linear-gradient(90deg,var(--accent),#60a5fa);
  border:none;
  padding:8px 12px;
  border-radius:8px;
  color:#022;
  font-weight:600;
  cursor:pointer;
}

button.secondary{
  background:transparent;
  border:1px solid rgba(255,255,255,0.06);
  color:var(--muted);
}

input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.04);
  background:var(--glass);
  color:inherit;
}

#reader{
  margin-top:10px;
}

.result-box{
  margin-top:15px;
  background:var(--glass);
  padding:12px;
  border-radius:10px;
  word-break: break-word; /* FIX OVERFLOW */
}

.action-row{
  display:flex;
  gap:8px;
  margin-top:10px;
  flex-wrap:wrap;
}
</style>
</head>
<body>

<div class="wrapper">

  <div class="card">
    <h2>Scan QR Code</h2>

    <div id="reader"></div>

    <div class="action-row">
      <button onclick="startScanner()">Start Camera</button>
      <button class="secondary" onclick="stopScanner()">Stop</button>
    </div>

    <p class="small" style="color:var(--muted);margin-top:10px;">Or upload QR image</p>
    <input type="file" id="qr-upload" accept="image/*">

    <div id="scan-result" class="result-box"></div>
  </div>

  <div class="card">
    <h2>Generate QR Code</h2>

    <input type="text" id="qr-input" placeholder="Enter link or text">

    <div class="action-row">
      <button onclick="generateQR()">Generate</button>
    </div>

    <div id="qr-output" style="margin-top:15px;"></div>
  </div>

</div>

<script>

let html5QrCode;

function startScanner(){
  html5QrCode = new Html5Qrcode("reader");

  html5QrCode.start(
    { facingMode:"environment" },
    { fps:10, qrbox:250 },
    message=>{
      showResult(message);
      stopScanner();
    }
  );
}

function stopScanner(){
  if(html5QrCode){
    html5QrCode.stop().then(()=>html5QrCode.clear());
  }
}

function showResult(text){
  const box = document.getElementById("scan-result");
  const isUrl = text.startsWith("http");

  box.innerHTML = `
    <strong>Decoded:</strong><br>
    ${text}
    <div class="action-row">
      <button onclick="copyText('${text}')">Copy</button>
      ${isUrl ? `<button onclick="redirectTo('${text}')">Redirect</button>` : ""}
    </div>
  `;
}

function copyText(text){
  navigator.clipboard.writeText(text);
}

function redirectTo(url){
  window.open(url,"_blank");
}

document.getElementById("qr-upload").addEventListener("change",function(e){
  const file = e.target.files[0];
  if(!file) return;

  const qr = new Html5Qrcode("reader");
  qr.scanFile(file,true)
    .then(decoded=>{
      showResult(decoded);
    })
    .catch(()=> alert("No QR found"));
});

function generateQR(){
  const input = document.getElementById("qr-input").value;
  const output = document.getElementById("qr-output");

  output.innerHTML="";
  if(!input) return;

  new QRCode(output,{
    text:input,
    width:200,
    height:200
  });
}

</script>

</body>
</html>
